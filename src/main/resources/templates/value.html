<!-- src/main/resources/templates/value.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Portfolio Value</title>
    <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; }
    .bar { display:flex; gap:1rem; align-items:center; margin-bottom:1rem; }
    table { border-collapse: collapse; width:100%; }
    th, td { border-bottom:1px solid #eee; padding:0.5rem 0.75rem; text-align:left; }
    th { background:#fafafa; position:sticky; top:0; }
    .right { text-align:right; }
    .muted { color:#777; font-size:0.9em; }
    button, select, input { padding:.4rem .6rem; border:1px solid #ccc; border-radius:6px; background:#f7f7f7; }
    button:hover { background:#efefef; cursor:pointer; }
  </style>
</head>
<body>
<h1>Portfolio value</h1>

<form class="bar" method="get" action="/value">
    <label>Account:</label>
    <input type="text" name="account" th:value="${account}">
    <label>Currency:</label>
    <select name="vs" th:value="${vs}">
        <option value="gbp" th:selected="${vs == 'gbp'}">GBP</option>
        <option value="usd" th:selected="${vs == 'usd'}">USD</option>
        <option value="eur" th:selected="${vs == 'eur'}">EUR</option>
    </select>
    <button type="submit">View</button>
</form>

<form class="bar" method="post" action="/value/refresh">
    <input type="hidden" name="account" th:value="${account}">
    <input type="hidden" name="vs" th:value="${vs}">
    <button type="submit">Refresh balances (Binance+Kraken) then value</button>
    <span class="muted">Requires API keys configured.</span>
</form>

<table>
    <thead>
    <tr>
        <th>Asset</th>
        <th class="right">Qty</th>
        <th class="right">Price (<span th:text="${vs.toUpperCase()}">GBP</span>)</th>
        <th class="right">Value (<span th:text="${vs.toUpperCase()}">GBP</span>)</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="l : ${lines}">
        <td th:text="${l.asset()}">BTC</td>
        <td class="right" th:text="${#numbers.formatDecimal(l.qty(),1,8)}">0.00000000</td>
        <td class="right" th:text="${l.price() != null ? #numbers.formatDecimal(l.price(),1,6) : '-'}">-</td>
        <td class="right" th:text="${l.value() != null ? #numbers.formatDecimal(l.value(),1,2) : '-'}">-</td>
    </tr>
    <tr th:if="${#lists.isEmpty(lines)}">
        <td colspan="4" class="muted">No holdings found. Refresh balances first.</td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
        <th colspan="3" class="right">Total</th>
        <th class="right" th:text="${#numbers.formatDecimal(total,1,2)}">0.00</th>
    </tr>
    </tfoot>
</table>

<p class="muted" th:if="${unresolved != null and !unresolved.isEmpty()}">
    Unresolved symbols (no CoinGecko id): <span th:text="${unresolved}">[]</span> â€” add them to the resolver map.
</p>
</body>
</html>
